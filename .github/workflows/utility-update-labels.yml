name: Update Labels

on:
  workflow_call:

jobs:
  create-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    env:
      LABELS_JSON: |
        [
          {"name": "area/documentation", "color": "0075ca", "description": "Improvements or additions to documentation"},
          {"name": "area/dev-tooling", "color": "002A68", "description": "Development Tooling"},
          {"name": "area/continuous-integration", "color": "00A4CC", "description": "Improvements or additions to Continuous Integration"},
          {"name": "area/continuous-delivery", "color": "FF6F3C", "description": "Improvements or additions to Continuous Delivery"},
          {"name": "area/license", "color": "1E3A5F", "description": "Licenses and Legal"},
          {"name": "dependencies", "color": "9AF807", "description": "Dependency Updates"},          
          {"name": "dependencies/dotnet-sdk", "color": "512BD4", "description": ".NET SDK Updates"},
          {"name": "dependencies/nuget", "color": "512BD4", "description": "NuGet Updates"},
          {"name": "dependencies/containers", "color": "0DB7ED", "description": "Container Updates"},
          {"name": "dependencies/github-actions", "color": "333333", "description": "GitHub Actions Updates"},
          {"name": "maintenance", "color": "2E7D32", "description": "Upkeep and tech debt reduction"},
          {"name": "major", "color": "11EF57", "description": "Breaking Changes"},
          {"name": "minor", "color": "EAC462", "description": "New Features"},
          {"name": "patch", "color": "B01E00", "description": "Bugfixes"},
          {"name": "stale", "color": "712B19", "description": "It's been a while this has been active"}
        ]
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const labels = JSON.parse(process.env.LABELS_JSON);
            for (const label of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  description: label.description || '',
                  color: label.color
                });
              }
              catch (error) {
                if (error.status === 422) {
                  console.log(`Label '${label.name}' already exists. Updating.`);
                  try {
                      await github.rest.issues.updateLabel({
                        accept: 'application/vnd.github+json',
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        name: label.name,
                        description: label.description || '',
                        color: label.color,
                      });
                  }
                  catch (error) {
                      console.log(`Label '${label.name}' couldn't be updated. Skipping.`);
                  }
                }
            else {
                  // Log other errors
                  console.error(`Error creating label '${label.name}': ${error}`);
                }
              }
            }
